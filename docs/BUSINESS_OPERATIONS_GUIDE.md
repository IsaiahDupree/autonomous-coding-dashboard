# Business Operations Guide — Safari Automation CRM

> How to use the Safari Automation + CRM stack to run a real business: find leads, qualify them, follow up, close, and track everything.

---

## The Core Loop

```
RESEARCH → IDENTIFY → ENRICH → REACH OUT → FOLLOW UP → CLOSE → SYNC
```

Every step maps directly to a running service and Supabase table.

---

## Step 1 — Market Research (Suite 3)

**What it does:** Scrapes posts, creators, and engagement data across Instagram, Twitter, TikTok, and Threads.

**Business use:**
- Find who is talking about your niche right now
- Identify the top 100 creators in any category
- Benchmark competitor profiles (follower count, avg likes/views, top posts)
- Discover what content formats and hooks are working

**How to run:**
```bash
# Keyword search across all platforms
python3 scripts/test_crm_e2e.py --suite research

# Or target a specific keyword via the market research API
curl -X POST http://localhost:3106/api/research/twitter/search \
  -H "Content-Type: application/json" \
  -d '{"keyword": "ai automation", "maxPosts": 50}'
```

**Output stored in Supabase:**
- `crm_market_research` — every scraped post with likes, views, shares, engagement score
- `crm_creators` — top creators with follower counts and top posts

**Business decision it enables:** Know EXACTLY who to target before you send a single message.

---

## Step 2 — Lead Identification

After research, query `crm_creators` and `crm_market_research` to build a lead list:

```sql
-- Top creators by engagement in your niche
SELECT username, platform, followers, avg_engagement_score
FROM crm_creators
WHERE niche = 'ai automation'
ORDER BY avg_engagement_score DESC
LIMIT 50;
```

---

## Step 3 — Enrich Contacts (Suite 2 + Suite 5)

**What it does:** Extract LinkedIn profiles (name, headline, location, mutual connections, connection degree) and score relationship depth with AI.

**Business use:**
- Before DMing someone, know their role, company, and whether you have mutual connections
- AI scores your existing relationships 0-100 so you know who to prioritize
- Auto-upserts enriched data into `crm_contacts`

**How to run:**
```bash
# LinkedIn profile extraction (navigates Safari to the profile, extracts via JS)
curl -X GET http://localhost:3105/api/linkedin/profile/extract-current

# AI relationship scoring
python3 scripts/test_crm_e2e.py --suite research
```

**Output stored in Supabase:**
- `crm_contacts.headline` — their current role
- `crm_contacts.relationship_score` — 0-100 Claude-scored depth
- `crm_contacts.linkedin_url`, `instagram_handle`, `twitter_handle`, `tiktok_handle`

---

## Step 4 — Direct Outreach (Suite 1)

**What it does:** Sends real DMs to contacts on Instagram, Twitter, TikTok, and LinkedIn. Verified delivery confirmed.

**Business use:**
- Cold outreach to creators, prospects, or partners
- Follow-up sequences triggered by pipeline stage
- Personalized messages generated by `crm_brain.py` (Claude-powered)

**How to run:**
```bash
# Send to a specific person on a platform
curl -X POST http://localhost:3001/api/messages/send-to \
  -H "Content-Type: application/json" \
  -d '{"username": "targethandle", "text": "Hey! Loved your recent post on X..."}'

# Run the full CRM brain queue (scores + sends top priority contacts)
python3 scripts/crm_brain.py --send --limit 10
```

**Platforms + ports:**
| Platform | Port | Endpoint |
|---|---|---|
| Instagram | 3001 | `POST /api/messages/send-to` |
| Twitter | 3003 | `POST /api/twitter/messages/send-to` |
| TikTok | 3102 | `POST /api/tiktok/messages/send-to` |
| LinkedIn | 3105 | `POST /api/linkedin/messages/send-to` |

**Output stored in Supabase:**
- `crm_messages` — every outbound message: platform, username, text, `is_outbound=true`, `sent_by_automation=true`, metadata

**Rate limits (enforced per-service):**
| Platform | Daily | Hourly |
|---|---|---|
| Instagram | ~20 | ~5 |
| Twitter | 50 | ~10 |
| TikTok | 30 | ~5 |
| LinkedIn | 50 | — |

---

## Step 5 — Engagement (Suite 4)

**What it does:** Posts comments on live platform posts (Instagram, Twitter, TikTok, Threads).

**Business use:**
- Top-of-funnel engagement before DMing (comment first, then DM days later)
- Reply to creator posts in your niche to build visibility
- AI-generated comments (Twitter supports `useAI=true`)

**How to run:**
```bash
# Comment on a Twitter post (AI-generated)
curl -X POST http://localhost:3007/api/comments/post \
  -H "Content-Type: application/json" \
  -d '{"postUrl": "https://x.com/user/status/...", "useAI": true}'

# Comment on Instagram
curl -X POST http://localhost:3005/api/comments/post \
  -H "Content-Type: application/json" \
  -d '{"postUrl": "https://www.instagram.com/p/...", "text": "This is exactly right!"}'
```

**Output stored in Supabase:**
- `crm_messages` — comment record with `message_type='comment'`, `postUrl`, `commentId`

---

## Step 6 — Inbox Sync (Suite 6)

**What it does:** Pulls all platform inboxes (Instagram, Twitter, TikTok, LinkedIn) into Supabase, creating contacts for anyone who has messaged you.

**Business use:**
- Never miss a reply — every inbound message syncs to `crm_messages`
- Contacts auto-created/updated from incoming conversations
- Track reply rates and conversation depth per contact

**Output stored in Supabase:**
- `crm_conversations` — every thread per contact per platform
- `crm_messages` — every message (inbound + outbound)
- `crm_contacts` — auto-upserted from conversation participants

---

## Step 7 — Pipeline Management

All contacts flow through stages tracked in `crm_contacts.pipeline_stage`:

```
new → qualified → contacted → replied → call_booked → closed_won / closed_lost
```

Query your pipeline at any time:
```sql
SELECT pipeline_stage, COUNT(*), AVG(relationship_score)
FROM crm_contacts
GROUP BY pipeline_stage
ORDER BY pipeline_stage;
```

Move contacts through stages:
```sql
UPDATE crm_contacts
SET pipeline_stage = 'replied', last_inbound_at = NOW()
WHERE platform = 'twitter' AND username = 'targethandle';
```

---

## Step 8 — Cloud Control (Suite 7)

**What it does:** Enqueue commands from anywhere in the cloud → local Safari daemon executes → result stored in Supabase.

**Business use:**
- Trigger outreach campaigns from a web dashboard or Zapier/Make webhook
- Schedule DMs and research tasks without being at your computer
- Full audit trail in `safari_command_queue`

**How to run:**
```bash
# Enqueue a DM from cloud
curl -X POST https://your-cloud-api/api/safari/enqueue \
  -d '{"action": "dm", "params": {"platform": "instagram", "username": "target", "text": "Hey!"}}'
```

**Output stored in Supabase:**
- `safari_command_queue` — action, params, status (`pending → running → complete`), result

---

## Full Business Workflow Example

### Goal: Land 3 new clients from the "AI copywriting" niche this month

**Week 1 — Research**
```bash
# Find top creators posting about AI copywriting
python3 scripts/test_crm_e2e.py --suite research
# → crm_creators now has top 100 handles with engagement data
# → crm_market_research has their best posts
```

**Week 1 — Enrich**
```bash
# Navigate to each LinkedIn profile, extract headline + mutual connections
# → crm_contacts.headline, relationship_score, linkedin_url populated
```

**Week 2 — Warm up (comment first)**
```bash
# Comment on their top 2-3 posts across platforms
python3 scripts/test_crm_e2e.py --suite comments
# → crm_messages records comments posted
```

**Week 2/3 — DM outreach**
```bash
# crm_brain scores all contacts and queues highest-priority DMs
python3 scripts/crm_brain.py --send --limit 5
# → crm_messages records every sent DM
```

**Week 3/4 — Track replies**
```bash
# Sync all platform inboxes to catch replies
python3 scripts/test_crm_e2e.py --suite sync
# → crm_messages records inbound replies
# → pipeline_stage auto-updated to 'replied'
```

**Ongoing — Query pipeline**
```sql
SELECT display_name, platform, pipeline_stage, relationship_score,
       last_outbound_at, last_inbound_at
FROM crm_contacts
WHERE pipeline_stage IN ('contacted','replied','call_booked')
ORDER BY relationship_score DESC;
```

---

## Services to Keep Running

```bash
bash scripts/start-services.sh
```

| Service | Port | Purpose |
|---|---|---|
| instagram-dm | 3001 | IG DM sends + inbox read |
| twitter-dm | 3003 | Twitter DM sends |
| threads-comments | 3004 | Threads commenting + research |
| instagram-comments | 3005 | IG commenting |
| tiktok-comments | 3006 | TikTok commenting |
| twitter-comments | 3007 | Twitter commenting + research |
| tiktok-dm | 3102 | TikTok DM sends |
| linkedin-automation | 3105 | LinkedIn everything |
| market-research | 3106 | Cross-platform research hub |

---

## Key Supabase Tables

| Table | Business Purpose |
|---|---|
| `crm_contacts` | Your full contact/lead database |
| `crm_messages` | Every message sent or received |
| `crm_conversations` | Thread-level conversation tracking |
| `crm_market_research` | Scraped posts for content intel |
| `crm_creators` | Ranked creator database by niche |
| `crm_message_queue` | AI-generated messages waiting to send |
| `safari_command_queue` | Cloud-triggered automation tasks |
| `linkedin_prospects` | Scored LinkedIn lead pipeline |
