<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="Real-time dashboard for monitoring Claude autonomous coding agent - track sessions, features, usage, and progress">
  <meta name="keywords" content="autonomous coding, Claude AI, coding agent, dashboard, monitoring">
  <title>Autonomous Coding Agent Dashboard</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
    rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="index.css">

  <!-- Chart.js for visualizations -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body>
  <!-- Project Sidebar -->
  <aside class="project-sidebar" id="project-sidebar">
    <div class="sidebar-header">
      <h3>Projects</h3>
      <button class="sidebar-toggle" id="sidebar-toggle" onclick="toggleProjectSidebar()">
        <span>‚óÄ</span>
      </button>
    </div>
    <div class="sidebar-content">
      <div id="projects-list" class="projects-list">
        <!-- Projects will be loaded here -->
      </div>
    </div>
    <div class="sidebar-footer">
      <button class="btn btn-secondary" onclick="addNewProject()" style="width: 100%; font-size: 0.875rem;">
        ‚ûï Add Project
      </button>
    </div>
  </aside>

  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="header-content">
        <div style="display: flex; gap: 0.5rem; align-items: center;">
          <button class="btn btn-secondary" id="sidebar-open-btn" onclick="toggleProjectSidebar()" title="Toggle Projects">
            üìÅ
          </button>
          <a href="#" class="logo">
            <div class="logo-icon">ü§ñ</div>
            <span>Autonomous Coding Agent</span>
          </a>
        </div>
        <div style="display: flex; gap: 1rem; align-items: center;">
          <button id="theme-toggle" title="Toggle theme">üåô</button>
          <label class="notification-toggle-container" title="Toggle browser notifications">
            <input type="checkbox" id="notifications-toggle" onchange="toggleNotifications()">
            <span class="notification-toggle-label">üîî</span>
          </label>
          <label class="notification-toggle-container" title="Toggle audio alerts">
            <input type="checkbox" id="audio-toggle" onchange="toggleAudio()">
            <span class="notification-toggle-label">üîä</span>
          </label>
          <button id="settings-btn" class="btn btn-secondary" onclick="openSettingsModal()" title="Harness Settings">‚öôÔ∏è</button>
          <button id="prompts-btn" class="btn btn-secondary" onclick="openPromptsModal()" title="Edit Prompts">üìù</button>
          <button id="prd-input-btn" class="btn btn-secondary" onclick="openPrdInputModal()" title="Add PRD Requirement">‚ûï</button>
          <button id="help-btn" class="btn btn-secondary" onclick="openHelpModal()" title="Help & Keyboard Shortcuts">‚ùì</button>
          <a href="index.html" class="btn">üìä Dashboard</a>
          <a href="queue.html" class="btn btn-secondary">üìã Project Queue</a>
          <a href="control.html" class="btn btn-secondary">üéÆ Control Panel</a>
          <div class="status-badge" id="agent-status">
            <span class="status-dot active"></span>
            <span id="status-text">Active - Session 5</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- Key Metrics Overview -->
    <section id="metrics-section" class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Features Completed</div>
        <div class="stat-value" id="features-completed">142</div>
        <div class="stat-change positive">
          <span>‚Üë 12 today</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-label">Total Sessions</div>
        <div class="stat-value" id="total-sessions">5</div>
        <div class="stat-change positive">
          <span>‚Üë 1 active</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-label">Success Rate</div>
        <div class="stat-value" id="success-rate">71%</div>
        <div class="stat-change positive">
          <span>‚Üë 3.2%</span>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-label">API Tokens Used</div>
        <div class="stat-value" id="tokens-used">2.4M</div>
        <div class="stat-change">
          <span>~$36.50 cost</span>
        </div>
      </div>
    </section>

    <!-- Main Content Grid -->
    <div class="grid grid-2">
      <!-- Current Session Progress Card -->
      <div class="card">
        <div class="card-header">
          <div>
            <h3 class="card-title">Current Session Progress</h3>
            <p class="card-subtitle">Session 5 - Coding Agent</p>
          </div>
          <span class="badge badge-success">RUNNING</span>
        </div>
        <div class="card-body">
          <div class="flex justify-between mb-1">
            <span>Features: 142/200</span>
            <span style="color: var(--color-primary); font-weight: 600;">71%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="main-progress" style="width: 71%"></div>
          </div>

          <div class="mt-2">
            <div class="flex justify-between" style="font-size: 0.875rem; color: var(--color-text-secondary);">
              <span>‚è±Ô∏è Session Duration: 2h 14m</span>
              <span>üìù Last Feature: User Authentication</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Harness Control Panel -->
      <div id="harness-control-panel">
        <!-- Harness control UI will be injected here by harness-control.js -->
      </div>

      <!-- Sleep/Wake Control Widget -->
      <div id="sleep-control-widget" class="mt-2">
        <!-- Sleep control UI will be injected here by sleep-control.js -->
      </div>
    </div>

    <!-- Session Statistics Row -->
    <div class="card mt-2">
      <div class="card-header">
        <h3 class="card-title">Session Statistics</h3>
      </div>
      <div class="card-body">
        <div class="grid grid-4" style="gap: 2rem;">
          <div class="flex flex-col">
            <span style="color: var(--color-text-secondary); font-size: 0.85rem;">Avg. Time per Feature</span>
            <span style="font-weight: 600; font-size: 1.25rem;">8.5 min</span>
          </div>
          <div class="flex flex-col">
            <span style="color: var(--color-text-secondary); font-size: 0.85rem;">Tests Passing</span>
            <span style="font-weight: 600; font-size: 1.25rem; color: var(--color-success);">142/142</span>
          </div>
          <div class="flex flex-col">
            <span style="color: var(--color-text-secondary); font-size: 0.85rem;">Git Commits</span>
            <span style="font-weight: 600; font-size: 1.25rem;">156</span>
          </div>
          <div class="flex flex-col">
            <span style="color: var(--color-text-secondary); font-size: 0.85rem;">Commands Executed</span>
            <span style="font-weight: 600; font-size: 1.25rem;">1,247</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Progress Chart -->
    <div class="card mt-2">
      <div class="card-header">
        <h3 class="card-title">Feature Completion Timeline</h3>
        <div class="flex gap-1">
          <button class="btn btn-secondary" onclick="updateChartView('24h')">24h</button>
          <button class="btn btn-secondary" onclick="updateChartView('7d')">7d</button>
          <button class="btn btn-secondary" onclick="updateChartView('all')">All</button>
        </div>
      </div>
      <div class="card-body">
        <div class="chart-container">
          <canvas id="progress-chart"></canvas>
        </div>
      </div>
    </div>

    <!-- Category Breakdown Chart -->
    <div class="card mt-2">
      <div class="card-header">
        <h3 class="card-title">Category Breakdown</h3>
        <span class="badge badge-info">By Category</span>
      </div>
      <div class="card-body">
        <div class="chart-container">
          <canvas id="category-chart"></canvas>
        </div>
      </div>
    </div>

    <!-- Live Log Viewer -->
    <div class="card mt-2">
      <div class="card-header">
        <h3 class="card-title">Harness Output</h3>
        <div class="flex gap-1" style="align-items: center;">
          <span class="badge badge-success" id="log-status">Live</span>
          <button class="btn btn-secondary" id="toggle-autoscroll" onclick="toggleAutoScroll()">
            <span id="autoscroll-icon">‚è∏Ô∏è</span> Pause
          </button>
          <button class="btn btn-secondary" onclick="clearLogs()">üóëÔ∏è Clear</button>
        </div>
      </div>
      <div class="card-body">
        <div id="log-viewer" class="log-viewer">
          <div id="log-content" class="log-content">
            <div class="log-line log-info">Waiting for harness output...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Two Column Layout -->
    <div class="grid grid-2 mt-2">
      <!-- Recent Activity Timeline -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Recent Activity</h3>
          <span class="badge badge-info">Live</span>
        </div>
        <div class="card-body">
          <div class="timeline" id="activity-timeline">
            <!-- Timeline items will be inserted here by JavaScript -->
          </div>
        </div>
      </div>

      <!-- Feature List -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Feature Status</h3>
          <div class="flex gap-1">
            <button class="btn btn-secondary" onclick="filterFeatures('all')">All</button>
            <button class="btn btn-secondary" onclick="filterFeatures('passing')">‚úì Passing</button>
            <button class="btn btn-secondary" onclick="filterFeatures('pending')">‚è≥ Pending</button>
          </div>
        </div>
        <div class="card-body">
          <div class="table-container">
            <table id="features-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Feature</th>
                  <th>Status</th>
                  <th>Time</th>
                </tr>
              </thead>
              <tbody id="features-tbody">
                <!-- Table rows will be inserted here by JavaScript -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Usage Analytics -->
    <div class="grid grid-2 mt-2">
      <!-- Token Usage Chart -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">API Token Usage</h3>
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="token-chart"></canvas>
          </div>
        </div>
      </div>

      <!-- Command Execution Stats -->
      <div class="card">
        <div class="card-header">
          <h3 class="card-title">Command Execution</h3>
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="commands-chart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Security & Command Logs -->
    <div class="card mt-2">
      <div class="card-header">
        <h3 class="card-title">Command Execution Log</h3>
        <span class="badge badge-success">Safe Mode Active</span>
      </div>
      <div class="card-body">
        <div class="table-container">
          <table id="commands-table">
            <thead>
              <tr>
                <th>Time</th>
                <th>Command</th>
                <th>Status</th>
                <th>Output</th>
              </tr>
            </thead>
            <tbody id="commands-tbody">
              <!-- Command rows will be inserted here by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Session History -->
    <div class="card mt-2">
      <div class="card-header">
        <h3 class="card-title">Session History</h3>
      </div>
      <div class="card-body">
        <div class="grid grid-3">
          <div class="stat-card" style="cursor: pointer;" onclick="viewSession(1)">
            <div class="stat-label">Session 1 - Initializer</div>
            <div class="stat-value" style="font-size: 1.25rem;">0 features</div>
            <div class="stat-change">
              <span>‚è±Ô∏è 4m 32s</span>
            </div>
            <span class="badge badge-success mt-1">Completed</span>
          </div>

          <div class="stat-card" style="cursor: pointer;" onclick="viewSession(2)">
            <div class="stat-label">Session 2 - Coding</div>
            <div class="stat-value" style="font-size: 1.25rem;">45 features</div>
            <div class="stat-change">
              <span>‚è±Ô∏è 6h 15m</span>
            </div>
            <span class="badge badge-success mt-1">Completed</span>
          </div>

          <div class="stat-card" style="cursor: pointer;" onclick="viewSession(3)">
            <div class="stat-label">Session 3 - Coding</div>
            <div class="stat-value" style="font-size: 1.25rem;">38 features</div>
            <div class="stat-change">
              <span>‚è±Ô∏è 5h 42m</span>
            </div>
            <span class="badge badge-success mt-1">Completed</span>
          </div>

          <div class="stat-card" style="cursor: pointer;" onclick="viewSession(4)">
            <div class="stat-label">Session 4 - Coding</div>
            <div class="stat-value" style="font-size: 1.25rem;">47 features</div>
            <div class="stat-change">
              <span>‚è±Ô∏è 7h 8m</span>
            </div>
            <span class="badge badge-success mt-1">Completed</span>
          </div>

          <div class="stat-card" style="cursor: pointer;" onclick="viewSession(5)">
            <div class="stat-label">Session 5 - Coding</div>
            <div class="stat-value" style="font-size: 1.25rem;">12 features</div>
            <div class="stat-change">
              <span>‚è±Ô∏è 2h 14m</span>
            </div>
            <span class="badge badge-warning mt-1">In Progress</span>
          </div>
        </div>
      </div>
    </div>

    <!-- E2E Test Runner Widget (feat-039) -->
    <div id="e2e-test-runner-widget" class="mt-2">
      <!-- E2E Test Runner UI will be injected here by e2e-test-runner.js -->
    </div>

    <!-- Git Activity -->
    <div class="card mt-2">
      <div class="card-header">
        <h3 class="card-title">Git Commit History</h3>
      </div>
      <div class="card-body">
        <div class="timeline" id="git-timeline">
          <!-- Git commits will be inserted here by JavaScript -->
        </div>
      </div>
    </div>
  </main>

  <script src="mock-data.js"></script>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="harness-client.js"></script>
  <script src="harness-control.js"></script>
  <script src="approval-ui.js"></script>
  <!-- Add Project Modal -->
  <div class="modal-overlay" id="add-project-modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add New Project</h2>
        <button class="modal-close" onclick="closeAddProjectModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="add-project-form" onsubmit="submitNewProject(event)">
          <div class="form-group">
            <label for="project-name">Project Name *</label>
            <input type="text" id="project-name" name="name" required placeholder="My Awesome Project">
          </div>

          <div class="form-group">
            <label for="project-path">Project Path *</label>
            <input type="text" id="project-path" name="path" required placeholder="/path/to/project">
            <small>Absolute path to the project directory</small>
          </div>

          <div class="form-group">
            <label for="project-description">Description</label>
            <textarea id="project-description" name="description" rows="3" placeholder="Brief description of the project"></textarea>
          </div>

          <div class="form-group">
            <label for="project-icon">Icon (emoji)</label>
            <input type="text" id="project-icon" name="icon" placeholder="üöÄ" maxlength="2">
            <small>Choose an emoji to represent this project</small>
          </div>

          <div class="form-group">
            <label for="project-color">Color</label>
            <input type="color" id="project-color" name="color" value="#6366f1">
            <small>Accent color for this project</small>
          </div>

          <div id="validation-message" class="validation-message" style="display: none;"></div>

          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" onclick="closeAddProjectModal()">Cancel</button>
            <button type="submit" class="btn btn-primary" id="submit-project-btn">Add Project</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settings-modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Harness Settings</h2>
        <button class="modal-close" onclick="closeSettingsModal()">&times;</button>
      </div>
      <div class="modal-body">
        <form id="settings-form" onsubmit="saveSettings(event)">
          <div class="form-group">
            <label for="max-sessions">Max Sessions</label>
            <input type="number" id="max-sessions" name="maxSessions" min="1" max="1000" value="100" required>
            <small class="form-help">Maximum number of coding sessions to run in continuous mode</small>
          </div>

          <div class="form-group">
            <label for="session-delay">Session Delay (seconds)</label>
            <input type="number" id="session-delay" name="sessionDelay" min="0" max="300" step="1" value="5" required>
            <small class="form-help">Delay between sessions in seconds (0-300)</small>
          </div>

          <div id="settings-validation-message" class="validation-message" style="display: none;"></div>

          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" onclick="closeSettingsModal()">Cancel</button>
            <button type="submit" class="btn btn-primary" id="save-settings-btn">Save Settings</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Prompts Editor Modal -->
  <div class="modal-overlay" id="prompts-modal" style="display: none;">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h2>Edit Agent Prompts</h2>
        <button class="modal-close" onclick="closePromptsModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="prompts-tabs">
          <button class="prompt-tab active" onclick="switchPromptTab('initializer')">Initializer Agent</button>
          <button class="prompt-tab" onclick="switchPromptTab('coding')">Coding Agent</button>
        </div>

        <div id="initializer-prompt-panel" class="prompt-panel active">
          <div class="form-group">
            <label for="initializer-prompt">Initializer Agent System Prompt</label>
            <textarea id="initializer-prompt" rows="20" class="prompt-textarea"></textarea>
            <small class="form-help">This prompt is used for the first session to set up the project structure</small>
          </div>
        </div>

        <div id="coding-prompt-panel" class="prompt-panel" style="display: none;">
          <div class="form-group">
            <label for="coding-prompt">Coding Agent System Prompt</label>
            <textarea id="coding-prompt" rows="20" class="prompt-textarea"></textarea>
            <small class="form-help">This prompt is used for coding sessions to implement features</small>
          </div>
        </div>

        <div id="prompts-validation-message" class="validation-message" style="display: none;"></div>

        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closePromptsModal()">Cancel</button>
          <button type="button" class="btn btn-secondary" onclick="resetPrompts()">Reset to Default</button>
          <button type="button" class="btn btn-primary" onclick="savePrompts()" id="save-prompts-btn">Save Prompts</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Help Modal (feat-024) -->
  <div class="modal-overlay" id="help-modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Help & Keyboard Shortcuts</h2>
        <button class="modal-close" onclick="closeHelpModal()" aria-label="Close">‚úï</button>
      </div>
      <div class="modal-body">
        <section class="help-section">
          <h3>About the Autonomous Coding Dashboard</h3>
          <p>
            This dashboard monitors and controls autonomous coding agents powered by the Claude Agent SDK.
            The harness system automatically implements features, commits code, and tracks progress across sessions.
          </p>
        </section>

        <section class="help-section">
          <h3>How the Harness Works</h3>
          <ol>
            <li><strong>Initializer Session:</strong> Reviews features and plans next steps</li>
            <li><strong>Coding Session:</strong> Implements one feature at a time</li>
            <li><strong>Testing & Verification:</strong> Tests the feature before marking as complete</li>
            <li><strong>Progress Tracking:</strong> Updates feature_list.json and claude-progress.txt</li>
            <li><strong>Continuous Mode:</strong> Repeats until all features are complete</li>
          </ol>
        </section>

        <section class="help-section">
          <h3>Keyboard Shortcuts</h3>
          <div class="shortcuts-grid">
            <div class="shortcut-item">
              <kbd>Cmd</kbd> + <kbd>S</kbd> <span class="shortcut-label">or</span> <kbd>Ctrl</kbd> + <kbd>S</kbd>
              <div class="shortcut-description">Start the harness</div>
            </div>
            <div class="shortcut-item">
              <kbd>Cmd</kbd> + <kbd>X</kbd> <span class="shortcut-label">or</span> <kbd>Ctrl</kbd> + <kbd>X</kbd>
              <div class="shortcut-description">Stop the harness</div>
            </div>
            <div class="shortcut-item">
              <kbd>Cmd</kbd> + <kbd>/</kbd> <span class="shortcut-label">or</span> <kbd>Ctrl</kbd> + <kbd>/</kbd>
              <div class="shortcut-description">Show this help dialog</div>
            </div>
          </div>
        </section>

        <section class="help-section">
          <h3>Quick Tips</h3>
          <ul>
            <li>Use <strong>Continuous Mode</strong> to run multiple sessions automatically</li>
            <li>Enable <strong>Browser Notifications</strong> üîî to get alerts when features complete</li>
            <li>Enable <strong>Audio Alerts</strong> üîä to hear success/error sounds</li>
            <li>Switch between projects using the sidebar üìÅ</li>
            <li>Configure harness settings with the gear icon ‚öôÔ∏è</li>
            <li>Edit system prompts with the pencil icon üìù</li>
          </ul>
        </section>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-primary" onclick="closeHelpModal()">Got it!</button>
      </div>
    </div>
  </div>

  <!-- PRD Input Modal (feat-028) -->
  <div class="modal-overlay" id="prd-input-modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add PRD Requirement</h2>
        <button class="modal-close" onclick="closePrdInputModal()" aria-label="Close">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="prd-requirement-text">Describe your requirement</label>
          <textarea
            id="prd-requirement-text"
            rows="5"
            placeholder="E.g., Add a search bar to filter features by category..."
            class="prompt-textarea"
          ></textarea>
          <small class="form-help">Describe the feature or requirement in natural language</small>
        </div>

        <div class="form-group">
          <label>Input Method</label>
          <div style="display: flex; gap: 1rem; align-items: center;">
            <button
              id="voice-input-btn"
              class="btn btn-secondary"
              onclick="toggleVoiceInput()"
              title="Use voice input"
            >
              <span id="voice-icon">üé§</span> <span id="voice-label">Start Voice Input</span>
            </button>
            <span id="voice-status" style="color: var(--color-text-secondary); font-size: 0.875rem;"></span>
          </div>
          <small class="form-help">Click to start/stop voice recording (uses browser's speech recognition)</small>
        </div>

        <div class="form-group">
          <label>Auto-Generated Acceptance Criteria</label>
          <div id="acceptance-criteria-preview" style="
            padding: 1rem;
            background: var(--color-bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--color-border);
            min-height: 100px;
          ">
            <p style="color: var(--color-text-secondary); font-style: italic;">
              Acceptance criteria will be generated automatically based on your requirement...
            </p>
          </div>
          <small class="form-help">These will be generated when you save the requirement</small>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" id="append-to-existing" checked>
            <span>Append to existing feature_list.json</span>
          </label>
          <small class="form-help">Uncheck to create a new PRD file</small>
        </div>

        <div id="prd-validation-message" class="validation-message" style="display: none;"></div>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" onclick="closePrdInputModal()">Cancel</button>
        <button type="button" class="btn btn-primary" onclick="savePrdRequirement()" id="save-prd-btn">
          Add Requirement
        </button>
      </div>
    </div>
  </div>

  <!-- Error Toast Container -->
  <div id="error-toast-container" class="error-toast-container"></div>

  <script src="git-timeline.js"></script>
  <script src="cost-tracker.js"></script>
  <script src="project-manager-ui.js"></script>
  <script src="prd-input.js"></script>
  <script src="sleep-control.js"></script>
  <script src="e2e-test-runner.js"></script>
  <script src="app.js"></script>
</body>

</html>