{"features":[
  {"id":"AAG-051","name":"ContextBuilder — build contact brief for DM generation","description":"For a contact, compile: display_name, platform, handle, score, score_reasoning, top 2 posts from crm_market_research, niche label, follower_count. Return ContactBrief dataclass","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-024"},
  {"id":"AAG-052","name":"MessageGenerator — Claude first DM generation","description":"Call Claude (claude-3-5-sonnet) with ContactBrief + service description + DM prompt template from PRD-024. Validate: max 4 sentences, no pitch, no generic opener, references their content. Retry once if validation fails","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-024"},
  {"id":"AAG-053","name":"MessageValidator — quality gate before send","description":"Rules: length <= 280 chars (Twitter), <= 500 chars (others). Must contain prospect-specific reference. Must not contain 'hope this finds', 'reach out', 'synergy', 'pick your brain'. Score 0-10, reject if <6","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-024"},
  {"id":"AAG-054","name":"SendRouter — platform → DM service mapping","description":"Map crm_contacts.primary_platform → DM service port + endpoint. Handle: instagram→3001 /api/messages/send-to, twitter→3003, tiktok→3102, linkedin→3105 (open+send flow). Return route config","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-024"},
  {"id":"AAG-055","name":"DMSender — send first DM + record result","description":"POST to DM service, parse success/failure response. On success: UPDATE pipeline_stage='contacted', INSERT crm_messages, INSERT acq_outreach_sequences (touch=1), INSERT acq_funnel_events. On failure: retry once after 60s, then mark failed","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-024"},
  {"id":"AAG-056","name":"Daily cap check before any DM send","description":"Check acq_daily_caps for dm + platform. If at limit, skip contact and mark acq_outreach_sequences.status='skipped', skip_reason='daily_cap'. Reschedule for tomorrow","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-024"},
  {"id":"AAG-057","name":"Outreach batch processor — process all ready_for_dm contacts","description":"Read crm_contacts WHERE pipeline_stage='ready_for_dm'. For each, run ContextBuilder → MessageGenerator → MessageValidator → SendRouter → DMSender. Respect daily cap across the batch","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-024"},
  {"id":"AAG-058","name":"Outreach queue — stage DMs for later send","description":"Generated messages written to crm_message_queue with status='pending_send', scheduled_at. Separate step sends them. Allows human preview before send if desired (dry_run flag inserts to queue but doesnt send)","category":"agent","priority":2,"status":"completed","passes":true,"prd":"PRD-024"},
  {"id":"AAG-059","name":"Service slug context per contact","description":"Each contact in acq_outreach_sequences has a service_slug field. Message generation uses service_description from that service's config. One contact can only be in one active service sequence at a time","category":"agent","priority":2,"status":"completed","passes":true,"prd":"PRD-024"},
  {"id":"AAG-060","name":"LinkedIn open+send DM flow","description":"LinkedIn DM requires 2 steps: POST /api/linkedin/messages/open {participantName}, then POST /api/linkedin/messages/send {text}. Wrap this in DMSender as linkedin_send() with retry logic","category":"integration","priority":1,"status":"completed","passes":true,"prd":"PRD-024"},
  {"id":"AAG-061","name":"POST /api/acquisition/outreach/generate endpoint","description":"Preview DM for a single contact without sending. Returns message_text, platform, validation_score, estimated_send_at. For human review before enabling auto-send","category":"api","priority":2,"status":"completed","passes":true,"prd":"PRD-024"},
  {"id":"AAG-062","name":"POST /api/acquisition/outreach/send endpoint","description":"Send pending outreach for up to N contacts. Accepts service_slug filter, limit, dry_run. Returns sent[], skipped[], failed[] with reasons","category":"api","priority":2,"status":"completed","passes":true,"prd":"PRD-024"},
  {"id":"AAG-063","name":"Outreach CLI — python3 acquisition/outreach_agent.py","description":"CLI flags: --generate (preview next N DMs), --send (send pending), --dry-run, --limit, --service. Print each DM with contact name and validation score","category":"setup","priority":2,"status":"completed","passes":true,"prd":"PRD-024"},
  {"id":"AAG-064","name":"Outreach tests","description":"pytest: test_context_builder_includes_posts, test_message_validator_rejects_generic, test_send_router_correct_port, test_daily_cap_blocks_send, test_linkedin_open_send_flow, test_message_written_to_crm_messages","category":"testing","priority":2,"status":"completed","passes":true,"prd":"PRD-024"},
  {"id":"AAG-139","name":"ChannelCoordinator — one active channel per contact","description":"Before scheduling email sequence: check if contact has active DM sequence in progress. If so, wait until DM sequence completes or times out. If DM gets reply, cancel pending email sequence. If DM archived, activate email","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-140","name":"Channel preference by source platform","description":"Contact seeded from LinkedIn → prefer email. Contact from Instagram/TikTok/Twitter → prefer DM. Store in crm_contacts.active_channel. Allow manual override via API","category":"agent","priority":2,"status":"completed","passes":true,"prd":"PRD-027"}
]}
