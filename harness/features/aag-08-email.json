{"features":[
  {"id":"AAG-123","name":"ResendClient — async Resend API wrapper","description":"acquisition/email/resend_client.py: send_email(to, subject, html, text) → resend_id. get_email_status(resend_id). Handles 422 invalid address, 429 rate limit (backoff), 5xx errors. RESEND_API_KEY from env","category":"integration","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-124","name":"EmailDiscovery — LinkedIn email extractor","description":"For contacts with linkedin_url, check if email is publicly listed on their profile. Use Safari LinkedIn automation (port 3105) to navigate profile, extract email if present in contact info section","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-125","name":"EmailDiscovery — website email extractor","description":"If contact has website_url, scrape contact/about page for email. Look for mailto: links, text matching email regex. Parse up to 3 pages per site. User-agent: Mozilla to avoid blocks","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-126","name":"EmailDiscovery — pattern guesser","description":"Given display_name + company domain (from LinkedIn or website), generate email candidates: {first}@domain, {first}.{last}@domain, {f}{last}@domain. Return as unverified candidates with confidence 0.4","category":"agent","priority":2,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-127","name":"EmailDiscovery — Perplexity email search","description":"Use Perplexity API: 'What is the email address for {name} the {niche} creator?' Parse structured response. Only accept if confidence >= 0.7 in returned data. Store source='perplexity'","category":"integration","priority":2,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-128","name":"EmailVerifier — MX record + SMTP check","description":"For each candidate email: verify MX record exists for domain (DNS lookup), then do SMTP RCPT TO check without sending. Mark email_verified=true if both pass. Skip SMTP for known providers (gmail, outlook, yahoo) that block verification","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-129","name":"EmailDiscoveryAgent.discover() — orchestrate all sources","description":"Run sources in priority order: linkedin → website → perplexity → pattern. Stop at first verified result. Store all candidates in acq_email_discoveries with confidence scores. UPDATE crm_contacts.email with highest-confidence verified result","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-130","name":"EmailContextBuilder — email-specific contact brief","description":"Extend DM ContextBuilder for email format. Add: company_name, job_title (from LinkedIn). Email-appropriate copy has more space than DM. Include company website context if known","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-131","name":"EmailGenerator — Claude subject + body per touch","description":"acquisition/email/email_generator.py: generate(contact_brief, touch_number, service_slug) → EmailDraft(subject, body_text, body_html). Uses touch-specific prompts from PRD-027. HTML wraps plaintext in clean minimal template","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-132","name":"EmailValidator — spam word + quality gate","description":"Validate generated email: no spam trigger words (list of 80+ words), subject <= 65 chars, body <= 200 words, must contain personal reference, must have clear CTA. Score 0-10, reject if <7. Regenerate once if rejected","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-133","name":"HTML email template — clean minimal design","description":"Simple responsive HTML template: plain white, sans-serif font, 600px max width, footer with unsubscribe link + physical address. Inlined CSS. Renders correctly in Gmail, Outlook, Apple Mail","category":"integration","priority":2,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-134","name":"EmailSequenceAgent — schedule 3-touch sequence for a contact","description":"Given contact with email + service_slug: create 3 acq_email_sequences rows with scheduled_at: touch1=now, touch2=now+4days, touch3=now+8days. Only if active_channel='email' or 'both'","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-135","name":"EmailSender — send scheduled emails","description":"Read acq_email_sequences WHERE status='pending' AND scheduled_at<=NOW(). For each: check email daily cap, call ResendClient.send_email(), UPDATE status='sent', sent_at, resend_id. Write to crm_messages (type='email', is_outbound=true)","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-136","name":"Daily email cap enforcement","description":"Check acq_daily_caps WHERE action='email'. Default limit: 30/day. Increment on each send. Block batch once limit hit. Reset at midnight UTC","category":"agent","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-137","name":"Resend webhook handler — open/click/bounce/complaint events","description":"POST /api/acquisition/email/webhooks/resend: verify Resend signature, parse event type, UPDATE acq_email_sequences (opened_at, clicked_at, status). On bounce: set email_verified=false, switch channel to dm. On complaint: add to unsubscribes","category":"integration","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-138","name":"IMAP reply detection — poll inbox for replies","description":"acquisition/email/imap_watcher.py: connect to IMAP (IMAP_HOST, IMAP_USER, IMAP_PASS from env), search for replies by In-Reply-To header matching resend_id. Run every 4h. On reply: stage='replied', trigger human notification","category":"integration","priority":2,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-141","name":"Unsubscribe handler — honor opt-outs immediately","description":"Add unsubscribe link to every email footer (unique per contact URL). GET /api/acquisition/email/unsubscribe?token={jwt}: set email_opted_out=true, cancel pending sequences, INSERT acq_email_unsubscribes. Confirm with plain page: 'You have been unsubscribed'","category":"integration","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-142","name":"Unsubscribe token — JWT with contact_id","description":"Generate signed JWT (HS256, EMAIL_UNSUB_SECRET) containing contact_id. Embed in unsubscribe URL. Verify on receipt. Expire in 365 days. Never re-email contacts in acq_email_unsubscribes","category":"integration","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-143","name":"POST /api/acquisition/email/discover endpoint","description":"Discover email for a contact. Accepts contact_id and sources[] filter. Returns: email, confidence, source, verified, discovery_time_ms","category":"api","priority":2,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-144","name":"POST /api/acquisition/email/send endpoint","description":"Send pending email sequences up to limit. Accepts dry_run. Returns sent[], skipped[], failed[] with reasons","category":"api","priority":2,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-145","name":"GET /api/acquisition/email/status endpoint","description":"Email pipeline metrics: pending sequences, sent today, open rate (7-day), click rate, bounce rate, reply rate, unsubscribe rate, cap usage","category":"api","priority":2,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-148","name":"Email tests — unit + integration","description":"pytest: test_email_validator_rejects_spam, test_resend_client_handles_422, test_channel_coordinator_blocks_dual_outreach, test_unsubscribe_token_valid, test_bounce_switches_channel_to_dm, test_daily_cap_blocks_at_30","category":"testing","priority":2,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-149","name":"Email CLI — python3 acquisition/email_agent.py","description":"Flags: --discover (find emails for qualified contacts), --send (send pending), --status, --dry-run. Print open/click/reply stats summary","category":"setup","priority":2,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-150","name":"Email performance in weekly report","description":"Add email channel section to PRD-026 weekly report: emails sent, open rate, click rate, reply rate vs DM reply rate comparison. Best subject line performers. Bounce rate alert if >5%","category":"reporting","priority":2,"status":"completed","passes":true,"prd":"PRD-027"}
]}
