{"features":[
  {"id":"AAG-076","name":"StateMachine — valid transition enforcement","description":"state_machine.py: VALID_TRANSITIONS dict. Function validate_transition(from_stage, to_stage) → raises InvalidTransitionError if not valid. All pipeline_stage updates must go through this","category":"orchestrator","priority":1,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-077","name":"DailyCapManager — init and reset daily caps","description":"On startup: ensure acq_daily_caps rows exist for all platform×action combinations. At midnight UTC: reset sent_today=0 for all rows. Expose check_cap(action, platform) and increment_cap(action, platform)","category":"orchestrator","priority":1,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-078","name":"Seed default daily caps","description":"INSERT default caps: dm_instagram=20, dm_twitter=50, dm_tiktok=30, dm_linkedin=50, comment_instagram=25, comment_twitter=40, comment_tiktok=25, comment_threads=30","category":"database","priority":1,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-079","name":"AcquisitionOrchestrator.run_step() — execute a single agent","description":"Dispatch to correct agent by step name. Steps: 'discovery', 'scoring', 'warmup', 'outreach', 'sync', 'followup', 'report'. Wrap in try/except, log to acq_discovery_runs on error","category":"orchestrator","priority":1,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-080","name":"Full pipeline run — orchestrator.run_all()","description":"Run all steps in order with guards. If daily cap hit for outreach step, skip gracefully. If any step fails, log and continue to next step (don't abort full pipeline)","category":"orchestrator","priority":1,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-081","name":"Cron registration — 7 acquisition cron jobs","description":"Add all 7 acquisition crons to cron_definitions.py: discovery(6AM), scoring(7AM), warmup(8AM), outreach(9AM), sync(every4h), followup(10AM), report(Mon9AM). Gate all with ENABLE_ACQUISITION env flag","category":"orchestrator","priority":1,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-082","name":"Workflow Engine DAG definition seed","description":"INSERT 'autonomous-acquisition' workflow definition into actp_workflow_definitions. 7-step DAG as specified in PRD-025. Seed via seed_acquisition_workflow.py script","category":"orchestrator","priority":2,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-083","name":"Acquisition executor for actp-worker","description":"AcquisitionExecutor class in workflow_executors.py. task_types: acquisition_discovery, icp_scoring, engagement_warmup, dm_outreach, inbox_sync, followup_sequence, pipeline_report. Delegates to agent modules","category":"orchestrator","priority":2,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-084","name":"Emergency pause/resume","description":"acq_orchestrator_state table (or env flag): ACQUISITION_PAUSED. Before any agent runs, check this flag. POST /api/acquisition/orchestrator/pause sets it. POST /api/acquisition/orchestrator/resume clears it","category":"orchestrator","priority":2,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-085","name":"RetryHandler — exponential backoff for failed steps","description":"Failed steps: wait 5min, retry. Still failing: wait 15min, retry. Still failing: wait 1hr, retry. After 3 failures: mark step failed, notify human, continue pipeline with other steps","category":"orchestrator","priority":2,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-086","name":"GET /api/acquisition/status — full dashboard endpoint","description":"Return pipeline stage counts, today's send/receive stats, daily cap usage per platform, agent last-run timestamps, overall health status. Sub-100ms response using pre-aggregated views","category":"api","priority":1,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-087","name":"POST /api/acquisition/orchestrator/run endpoint","description":"Manually trigger a specific step. Accepts step name and dry_run flag. Blocks for up to 30s then returns result or run_id for polling","category":"api","priority":2,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-088","name":"Supabase materialized view — pipeline_snapshot","description":"CREATE VIEW acq_pipeline_snapshot AS SELECT pipeline_stage, COUNT(*), AVG(relationship_score) FROM crm_contacts GROUP BY pipeline_stage. Used by status endpoint for fast reads","category":"database","priority":2,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-089","name":"Orchestrator CLI — python3 acquisition/orchestrator.py","description":"CLI flags: --run-all, --step NAME, --status, --dry-run, --pause, --resume. Print formatted pipeline status table after each run","category":"setup","priority":2,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-090","name":"Heartbeat integration — add acquisition to actp heartbeat","description":"In heartbeat_agent.py, add acquisition pipeline health check: pipeline stage counts, today's send stats, last agent run times, cap usage. Include in HEARTBEAT.md daily note","category":"integration","priority":2,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-091","name":"ENABLE_ACQUISITION env flag — gate all crons","description":"All 7 acquisition crons check ENABLE_ACQUISITION env var before running. Default False. Set True in .env to activate. Add to env.example with documentation","category":"setup","priority":1,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-092","name":"Orchestrator tests","description":"pytest: test_state_machine_valid_transitions, test_state_machine_invalid_raises, test_daily_cap_blocks_at_limit, test_daily_cap_resets_at_midnight, test_pause_blocks_all_steps, test_full_pipeline_continues_on_step_failure","category":"testing","priority":2,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-112","name":"FastAPI server — acquisition/api/server.py","description":"FastAPI app with all acquisition routes mounted. Auth via API key header (X-API-Key). CORS configured. Health endpoint. Auto-generates OpenAPI docs at /docs","category":"api","priority":2,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-113","name":"Pydantic schemas for all request/response models","description":"acquisition/api/schemas.py: NicheConfigCreate, NicheConfigUpdate, DiscoveryRunResult, WarmupStatus, OutreachRequest, OutreachResult, FollowUpResult, PipelineStatus, WeeklyReport schemas","category":"api","priority":2,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-115","name":"Dockerfile for acquisition service","description":"Python 3.11 slim base. Install requirements. EXPOSE 8080. CMD uvicorn acquisition.api.server:app. Add to docker-compose.yml","category":"setup","priority":3,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-117","name":"End-to-end integration test — full pipeline dry run","description":"test_e2e_acquisition_pipeline.py: seed 3 test contacts, run full pipeline with dry_run=True, verify each stage transition, verify no DMs sent, verify all DB records created correctly","category":"testing","priority":1,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-118","name":"Rate limit recovery — retry tomorrow on cap hit","description":"When a contact's DM is skipped due to daily cap, UPDATE acq_outreach_sequences.scheduled_at = tomorrow 9AM. Contact stays in pipeline, not archived","category":"agent","priority":2,"status":"completed","passes":true,"prd":"PRD-025"},
  {"id":"AAG-119","name":"Acquisition dashboard endpoint — GET /api/acquisition/dashboard","description":"Comprehensive single-call dashboard: pipeline snapshot + today stats + agent health + latest report summary + cap usage. Designed for a future web UI to render in one request","category":"api","priority":3,"status":"completed","passes":true,"prd":"PRD-026"},
  {"id":"AAG-146","name":"Email discovery cron — daily 7:30AM","description":"After scoring cron runs, trigger email discovery for all newly qualified contacts that have linkedin_url or website_url. Run as separate cron: acquisition_email_discovery (7:30AM daily). Gate with ENABLE_ACQUISITION","category":"orchestrator","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-147","name":"Email send cron — daily 9:30AM","description":"After DM outreach cron (9AM), send pending email sequences for email-channel contacts. acquisition_email_send (9:30AM daily)","category":"orchestrator","priority":1,"status":"completed","passes":true,"prd":"PRD-027"},
  {"id":"AAG-174","name":"Resolution cron — daily 6:30AM","description":"Run after discovery cron. acquisition_entity_resolution (6:30AM daily). Process up to 20 unresolved contacts from queue. Gate with ENABLE_ACQUISITION and PERPLEXITY_API_KEY existence","category":"orchestrator","priority":1,"status":"completed","passes":true,"prd":"PRD-028"}
]}
